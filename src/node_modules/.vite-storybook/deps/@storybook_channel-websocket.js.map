{
  "version": 3,
  "sources": ["dep:@storybook_channel-websocket", "../../../../node_modules/@storybook/channel-websocket/dist/esm/index.js"],
  "sourcesContent": ["import d from \"../node_modules/@storybook/channel-websocket/dist/esm/index.js\";export default d;\nexport * from \"../node_modules/@storybook/channel-websocket/dist/esm/index.js\"", "import \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nimport global from 'global';\nimport { Channel } from '@storybook/channels';\nimport { logger } from '@storybook/client-logger';\nimport { isJSON, parse, stringify } from 'telejson';\nvar WebSocket = global.WebSocket;\nexport var WebsocketTransport = /*#__PURE__*/function () {\n  function WebsocketTransport(_ref) {\n    var url = _ref.url,\n        onError = _ref.onError;\n\n    _classCallCheck(this, WebsocketTransport);\n\n    this.socket = void 0;\n    this.handler = void 0;\n    this.buffer = [];\n    this.isReady = false;\n    this.connect(url, onError);\n  }\n\n  _createClass(WebsocketTransport, [{\n    key: \"setHandler\",\n    value: function setHandler(handler) {\n      this.handler = handler;\n    }\n  }, {\n    key: \"send\",\n    value: function send(event) {\n      if (!this.isReady) {\n        this.sendLater(event);\n      } else {\n        this.sendNow(event);\n      }\n    }\n  }, {\n    key: \"sendLater\",\n    value: function sendLater(event) {\n      this.buffer.push(event);\n    }\n  }, {\n    key: \"sendNow\",\n    value: function sendNow(event) {\n      var data = stringify(event, {\n        maxDepth: 15,\n        allowFunction: true\n      });\n      this.socket.send(data);\n    }\n  }, {\n    key: \"flush\",\n    value: function flush() {\n      var _this = this;\n\n      var buffer = this.buffer;\n      this.buffer = [];\n      buffer.forEach(function (event) {\n        return _this.send(event);\n      });\n    }\n  }, {\n    key: \"connect\",\n    value: function connect(url, onError) {\n      var _this2 = this;\n\n      this.socket = new WebSocket(url);\n\n      this.socket.onopen = function () {\n        _this2.isReady = true;\n\n        _this2.flush();\n      };\n\n      this.socket.onmessage = function (_ref2) {\n        var data = _ref2.data;\n        var event = typeof data === 'string' && isJSON(data) ? parse(data) : data;\n\n        _this2.handler(event);\n      };\n\n      this.socket.onerror = function (e) {\n        if (onError) {\n          onError(e);\n        }\n      };\n    }\n  }]);\n\n  return WebsocketTransport;\n}();\nexport default function createChannel(_ref3) {\n  var url = _ref3.url,\n      _ref3$async = _ref3.async,\n      async = _ref3$async === void 0 ? false : _ref3$async,\n      _ref3$onError = _ref3.onError,\n      onError = _ref3$onError === void 0 ? function (err) {\n    return logger.warn(err);\n  } : _ref3$onError;\n  var transport = new WebsocketTransport({\n    url: url,\n    onError: onError\n  });\n  return new Channel({\n    transport: transport,\n    async: async\n  });\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;ACAA;iCAAO;AACP;AAQA,oBAAmB;AACnBA;AACA;AACAA;AATA,SAASC,gBAAgBC,UAAUC,aAAa;AAAE,MAAI,EAAED,oBAAoBC,cAAc;AAAE,UAAM,IAAIC,UAAU,mCAAd;EAAqD;AAAE;AAEzJ,SAASC,kBAAkBC,QAAQC,OAAO;AAAE,WAASC,IAAI,GAAGA,IAAID,MAAME,QAAQD,KAAK;AAAE,QAAIE,aAAaH,MAAMC;AAAIE,eAAWC,aAAaD,WAAWC,cAAc;AAAOD,eAAWE,eAAe;AAAM,QAAI,WAAWF;AAAYA,iBAAWG,WAAW;AAAMC,WAAOC,eAAeT,QAAQI,WAAWM,KAAKN,UAA9C;EAA4D;AAAE;AAE7T,SAASO,aAAad,aAAae,YAAYC,aAAa;AAAE,MAAID;AAAYb,sBAAkBF,YAAYiB,WAAWF,UAAxB;AAAqC,MAAIC;AAAad,sBAAkBF,aAAagB,WAAd;AAA4BL,SAAOC,eAAeZ,aAAa,aAAa;IAAEU,UAAU;EAAZ,CAAhD;AAAsE,SAAOV;AAAc;AAM7R,IAAIkB,YAAYC,cAAAA,QAAOD;AAChB,IAAIE,qBAAkC,WAAY;AACvD,WAASA,oBAAmBC,MAAM;AAChC,QAAIC,MAAMD,KAAKC,KACXC,UAAUF,KAAKE;AAEnBzB,oBAAgB,MAAMsB,mBAAP;AAEf,SAAKI,SAAS;AACd,SAAKC,UAAU;AACf,SAAKC,SAAS,CAAA;AACd,SAAKC,UAAU;AACf,SAAKC,QAAQN,KAAKC,OAAlB;EACD;AAEDT,eAAaM,qBAAoB,CAAC;IAChCP,KAAK;IACLgB,OAAO,SAASC,WAAWL,SAAS;AAClC,WAAKA,UAAUA;IAChB;EAJ+B,GAK/B;IACDZ,KAAK;IACLgB,OAAO,SAASE,KAAKC,OAAO;AAC1B,UAAI,CAAC,KAAKL,SAAS;AACjB,aAAKM,UAAUD,KAAf;MACD,OAAM;AACL,aAAKE,QAAQF,KAAb;MACD;IACF;EARA,GASA;IACDnB,KAAK;IACLgB,OAAO,SAASI,UAAUD,OAAO;AAC/B,WAAKN,OAAOS,KAAKH,KAAjB;IACD;EAJA,GAKA;IACDnB,KAAK;IACLgB,OAAO,SAASK,QAAQF,OAAO;AAC7B,UAAII,OAAOC,UAAUL,OAAO;QAC1BM,UAAU;QACVC,eAAe;MAFW,CAAR;AAIpB,WAAKf,OAAOO,KAAKK,IAAjB;IACD;EARA,GASA;IACDvB,KAAK;IACLgB,OAAO,SAASW,QAAQ;AACtB,UAAIC,QAAQ;AAEZ,UAAIf,SAAS,KAAKA;AAClB,WAAKA,SAAS,CAAA;AACdA,aAAOgB,QAAQ,SAAUV,OAAO;AAC9B,eAAOS,MAAMV,KAAKC,KAAX;MACR,CAFD;IAGD;EAVA,GAWA;IACDnB,KAAK;IACLgB,OAAO,SAASD,QAAQN,KAAKC,SAAS;AACpC,UAAIoB,SAAS;AAEb,WAAKnB,SAAS,IAAIN,UAAUI,GAAd;AAEd,WAAKE,OAAOoB,SAAS,WAAY;AAC/BD,eAAOhB,UAAU;AAEjBgB,eAAOH,MAAP;MACD;AAED,WAAKhB,OAAOqB,YAAY,SAAUC,OAAO;AACvC,YAAIV,OAAOU,MAAMV;AACjB,YAAIJ,QAAQ,OAAOI,SAAS,YAAYW,OAAOX,IAAD,IAASY,MAAMZ,IAAD,IAASA;AAErEO,eAAOlB,QAAQO,KAAf;MACD;AAED,WAAKR,OAAOyB,UAAU,SAAUC,GAAG;AACjC,YAAI3B,SAAS;AACXA,kBAAQ2B,CAAD;QACR;MACF;IACF;EAzBA,CAvC8B,CAArB;AAmEZ,SAAO9B;AACR,EAlF4C;AAmF9B,SAAf,cAAsC+B,OAAO;AAC3C,MAAI7B,MAAM6B,MAAM7B,KACZ8B,cAAcD,MAAME,OACpBA,QAAQD,gBAAgB,SAAS,QAAQA,aACzCE,gBAAgBH,MAAM5B,SACtBA,UAAU+B,kBAAkB,SAAS,SAAUC,KAAK;AACtD,WAAOC,OAAOC,KAAKF,GAAZ;EACR,IAAGD;AACJ,MAAII,YAAY,IAAItC,mBAAmB;IACrCE;IACAC;EAFqC,CAAvB;AAIhB,SAAO,IAAIoC,QAAQ;IACjBD;IACAL;EAFiB,CAAZ;AAIR;;;ADjH8E,IAAO,sCAAQ;",
  "names": ["init_esm", "_classCallCheck", "instance", "Constructor", "TypeError", "_defineProperties", "target", "props", "i", "length", "descriptor", "enumerable", "configurable", "writable", "Object", "defineProperty", "key", "_createClass", "protoProps", "staticProps", "prototype", "WebSocket", "global", "WebsocketTransport", "_ref", "url", "onError", "socket", "handler", "buffer", "isReady", "connect", "value", "setHandler", "send", "event", "sendLater", "sendNow", "push", "data", "stringify", "maxDepth", "allowFunction", "flush", "_this", "forEach", "_this2", "onopen", "onmessage", "_ref2", "isJSON", "parse", "onerror", "e", "_ref3", "_ref3$async", "async", "_ref3$onError", "err", "logger", "warn", "transport", "Channel"]
}
