import {
  init_esm as init_esm3,
  isJSON,
  parse,
  stringify
} from "./chunk-SNOMC6VJ.js";
import "./chunk-KG7BQZDK.js";
import "./chunk-I5E2LDZG.js";
import "./chunk-MLRES4EW.js";
import "./chunk-SOXTS23D.js";
import "./chunk-JL3N5MFZ.js";
import "./chunk-BRZ4O3VM.js";
import "./chunk-FFTII2VF.js";
import "./chunk-M44U7DA3.js";
import "./chunk-YTGDRGKZ.js";
import "./chunk-I23GJHOG.js";
import "./chunk-ONHSBKBM.js";
import "./chunk-O6SCRI3K.js";
import "./chunk-2FEBKAZL.js";
import {
  Channel,
  init_esm as init_esm2
} from "./chunk-4ZGR7LKU.js";
import "./chunk-VYLTT7BA.js";
import {
  init_web_dom_collections_for_each
} from "./chunk-BNKHNS7O.js";
import "./chunk-CFMFTW6U.js";
import "./chunk-OLZ5WG4Z.js";
import "./chunk-N2FZLRTI.js";
import "./chunk-XAJ4SFQJ.js";
import {
  init_esm,
  logger
} from "./chunk-WDY4P2NX.js";
import {
  require_es_object_to_string
} from "./chunk-IPK6NK5O.js";
import {
  require_window
} from "./chunk-XCM4TOIV.js";
import {
  __toESM,
  init_define_ngDevMode
} from "./chunk-XN7ES5DP.js";

// dep:@storybook_channel-websocket
init_define_ngDevMode();

// node_modules/@storybook/channel-websocket/dist/esm/index.js
init_define_ngDevMode();
var import_es_object_to_string = __toESM(require_es_object_to_string());
init_web_dom_collections_for_each();
var import_global = __toESM(require_window());
init_esm2();
init_esm();
init_esm3();
function _classCallCheck(instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
}
function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor)
      descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}
function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps)
    _defineProperties(Constructor.prototype, protoProps);
  if (staticProps)
    _defineProperties(Constructor, staticProps);
  Object.defineProperty(Constructor, "prototype", {
    writable: false
  });
  return Constructor;
}
var WebSocket = import_global.default.WebSocket;
var WebsocketTransport = function() {
  function WebsocketTransport2(_ref) {
    var url = _ref.url, onError = _ref.onError;
    _classCallCheck(this, WebsocketTransport2);
    this.socket = void 0;
    this.handler = void 0;
    this.buffer = [];
    this.isReady = false;
    this.connect(url, onError);
  }
  _createClass(WebsocketTransport2, [{
    key: "setHandler",
    value: function setHandler(handler) {
      this.handler = handler;
    }
  }, {
    key: "send",
    value: function send(event) {
      if (!this.isReady) {
        this.sendLater(event);
      } else {
        this.sendNow(event);
      }
    }
  }, {
    key: "sendLater",
    value: function sendLater(event) {
      this.buffer.push(event);
    }
  }, {
    key: "sendNow",
    value: function sendNow(event) {
      var data = stringify(event, {
        maxDepth: 15,
        allowFunction: true
      });
      this.socket.send(data);
    }
  }, {
    key: "flush",
    value: function flush() {
      var _this = this;
      var buffer = this.buffer;
      this.buffer = [];
      buffer.forEach(function(event) {
        return _this.send(event);
      });
    }
  }, {
    key: "connect",
    value: function connect(url, onError) {
      var _this2 = this;
      this.socket = new WebSocket(url);
      this.socket.onopen = function() {
        _this2.isReady = true;
        _this2.flush();
      };
      this.socket.onmessage = function(_ref2) {
        var data = _ref2.data;
        var event = typeof data === "string" && isJSON(data) ? parse(data) : data;
        _this2.handler(event);
      };
      this.socket.onerror = function(e) {
        if (onError) {
          onError(e);
        }
      };
    }
  }]);
  return WebsocketTransport2;
}();
function createChannel(_ref3) {
  var url = _ref3.url, _ref3$async = _ref3.async, async = _ref3$async === void 0 ? false : _ref3$async, _ref3$onError = _ref3.onError, onError = _ref3$onError === void 0 ? function(err) {
    return logger.warn(err);
  } : _ref3$onError;
  var transport = new WebsocketTransport({
    url,
    onError
  });
  return new Channel({
    transport,
    async
  });
}

// dep:@storybook_channel-websocket
var storybook_channel_websocket_default = createChannel;
export {
  WebsocketTransport,
  storybook_channel_websocket_default as default
};
//# sourceMappingURL=@storybook_channel-websocket.js.map
